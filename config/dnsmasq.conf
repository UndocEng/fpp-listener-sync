# =============================================================================
# dnsmasq.conf — DHCP + DNS for SHOW_AUDIO Network
# =============================================================================
# Provides two services on the isolated show WiFi network (wlan1):
#
# 1. DHCP Server: assigns IP addresses to phones that connect.
#    Range: 192.168.50.10 — 192.168.50.250 (supports ~240 simultaneous phones)
#    Lease time: 12 hours (covers a full evening show + setup)
#
# 2. DNS Server: wildcard resolution — ALL domain lookups resolve to 192.168.50.1.
#    This is the key to the captive portal. When a phone tries to load
#    google.com, connectivitycheck.gstatic.com, or any other domain, DNS
#    returns the Pi's IP. Apache then redirects to /listen/.
#
# Only listens on wlan1 (192.168.50.1) — does NOT affect DNS on wlan0/eth0.
# Deployed to: /etc/dnsmasq.conf (replaces default, backup saved by install.sh)
# =============================================================================

# Only serve DHCP/DNS on the show network interface
interface=wlan1

# bind-dynamic: only bind to interfaces that exist (avoids startup failures
# if wlan1 isn't up yet). Unlike bind-interfaces, this adapts as interfaces
# come and go.
bind-dynamic

# DHCP range: .10 to .250, netmask /24, 12-hour leases
dhcp-range=192.168.50.10,192.168.50.250,255.255.255.0,12h

# Only listen on the show network IP
listen-address=192.168.50.1

# DHCP option 6 = DNS server. Tells phones "use 192.168.50.1 for DNS"
# This ensures phones use our wildcard DNS, not their carrier's DNS.
dhcp-option=6,192.168.50.1

# Explicit entry for "listen.local" — resolves to the Pi.
# Note: this works via DNS, not mDNS. Some phones with Private DNS enabled
# may bypass this by using DNS-over-HTTPS to their carrier's resolver.
address=/listen.local/192.168.50.1

# WILDCARD DNS: resolve ALL domains to the Pi's IP.
# This is what makes the captive portal work — any HTTP request to any
# domain hits Apache on the Pi, which redirects to /listen/.
# The "#" means "match everything not already matched above."
address=/#/192.168.50.1

# Log DHCP transactions (useful for debugging "phone won't connect" issues)
# View with: journalctl -u dnsmasq -f
log-dhcp
